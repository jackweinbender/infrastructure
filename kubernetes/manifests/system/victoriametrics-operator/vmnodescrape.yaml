apiVersion: operator.victoriametrics.com/v1beta1
kind: VMNodeScrape
metadata:
  name: node-metrics
spec:
  # Scrape cadvisor (container metrics)
  scheme: "https"
  tlsConfig:
    insecureSkipVerify: true
    caFile: "/var/run/secrets/kubernetes.io/serviceaccount/ca.crt"
  bearerTokenFile: "/var/run/secrets/kubernetes.io/serviceaccount/token"
  path: /metrics/cadvisor
  relabelConfigs:
    - action: labelmap
      regex: __meta_kubernetes_node_label_(.+)

  # Also scrape standard node metrics (if exposed efficiently by kubelet on /metrics or via node-exporter if dedicated)
  # Usually /metrics on kubelet is summary, but capable of providing node info.
  # For robust settings, we often rely on independent node-exporter.
  # Assuming standard K8s setup, let's also try to grab kubelet stats.
---
apiVersion: operator.victoriametrics.com/v1beta1
kind: VMNodeScrape
metadata:
  name: kubelet-metrics
spec:
  scheme: "https"
  tlsConfig:
    insecureSkipVerify: true
    caFile: "/var/run/secrets/kubernetes.io/serviceaccount/ca.crt"
  bearerTokenFile: "/var/run/secrets/kubernetes.io/serviceaccount/token"
  path: /metrics
  relabelConfigs:
    - action: labelmap
      regex: __meta_kubernetes_node_label_(.+)
