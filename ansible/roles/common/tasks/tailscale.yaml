- name: add tailscale apt repo
  block:
    - name: get signing key
      get_url:
        url: https://pkgs.tailscale.com/stable/{{ ansible_distribution|lower}}/{{ ansible_distribution_release }}.asc
        dest: /etc/apt/keyrings/tailscale.asc
        mode: "0644"
        force: true
    - name: add apt repo
      apt_repository:
        repo: "deb [signed-by=/etc/apt/keyrings/tailscale.asc] https://pkgs.tailscale.com/stable/{{ ansible_distribution|lower}} {{ ansible_distribution_release }} main"
        filename: tailscale
        state: present

- name: install tailscale cli
  apt:
    name: tailscale
    state: latest
    cache_valid_time: 3600
